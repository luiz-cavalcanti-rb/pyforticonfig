<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config-O-Matic</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- Include CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.css">
</head>
<body>
    <h1>Gerador de Configuração FortiGate</h1>
    
    <div class="floating-box" id="generated-files">
        <button onclick="toggleFiles()">Arquivos gerados</button>
        <div id="files-content">
            <ul>
                {% for file in files %}
                    <li>
                        <span>{{ file }}</span>
                        <button onclick="openEditor('{{ file }}')">Editar</button>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- CodeMirror TextArea -->
    <div id="editor-container" style="display: none;">
        <textarea id="file-editor"></textarea>
        <button onclick="saveFile()">Salvar</button>
        <button onclick="closeEditor()">Fechar</button>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <!-- Include CodeMirror JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/python/python.min.js"></script> <!-- Example mode, you can change it as needed -->
    <script>
        var editor; // Declare editor variable
        
        // Function to open file for editing
		function openEditor(filename) {
            window.open('/edit?filename=' + encodeURIComponent(filename), '_blank', 'width=800,height=600');
        }
		//
        function editFile(filename) {
            // Check if editor already exists
            if (!editor) {
                // Make AJAX request to get file content
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/static/' + filename, true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        var content = xhr.responseText;
                        // Show editor and set content
                        document.getElementById('editor-container').style.display = 'block';
                        editor = CodeMirror.fromTextArea(document.getElementById("file-editor"), {
                            lineNumbers: true, // Enable line numbers
                            mode: "python" // Set the syntax highlighting mode (you can change it based on your file type)
                            // You can add more configuration options as needed
                        });
                        editor.setValue(content); // Set content in the editor
                    }
                };
                xhr.send();
            } else {
                editor.toTextArea(); // Convert editor back to textarea
                editor = null; // Reset editor variable
                editFile(filename); // Call editFile again to recreate editor for new file
            }
        }

        // Function to save edited file
        function saveFile() {
            var filename = document.getElementById('files-content').querySelector('span').innerText;
            var content = editor.getValue(); // Get content from the editor
            // Make AJAX request to save file
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/save_file', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        alert('File saved successfully.');
                    } else {
                        alert('Error: ' + response.message);
                    }
                }
            };
            xhr.send('filename=' + encodeURIComponent(filename) + '&content=' + encodeURIComponent(content));
        }

        // Function to close editor without saving
        function closeEditor() {
            document.getElementById('editor-container').style.display = 'none';
        }
    </script>
</body>
	
    <form action="/generate" method="post">
        <label for="fortigateSN">Numero de série do FortiGate: </label>
		<input type="text" id="fortigateSN" name="fortigateSN" pattern=".{16}" maxlength="16" title="Exactly 16 characters required" required><br><br>
		
		<label for="obra">Nome: </label>
		<input type="text" id="obra" name="obra" required><br><br>
		
		<label for="wanIP">IP interface wan: </label>
		<input type="text" id="wanIP" name="wanIP" required><br><br>
		
		<label for="wanMASK">Máscara interface wan: </label>
		<input type="text" id="wanMASK" name="wanMASK" pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" title="Subnet mask must be in dotted decimal format" value="255.255.255.252" placeholder="255.255.255.252" required><br><br>
		
		<label for="wanGW">Gateway interface wan: </label>
		<input type="text" id="wanGW" name="wanGW" required><br><br>
		
		<label for="vlan1IP">IP vlan 1: </label>
		<input type="text" id="vlan1IP" name="vlan1IP" required><br><br>
		
		<label for="vlan1MASK">Máscara vlan 1: </label>
		<input type="text" id="vlan1MASK" name="vlan1MASK" pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" title="Subnet mask must be in dotted decimal format" value="255.255.255.0" placeholder="255.255.255.0" required><br><br>
		
		<label for="wificorpVID">VID vlan corporativa: </label>
		<input type="number" id="wificorpVID" name="wificorpVID" min="1" max="4096" required><br><br>
		
		<label for="wificorpIP">IP vlan corporativa: </label>
		<input type="text" id="wificorpIP" name="wificorpIP" required><br><br>
		
		<label for="wificorpMASK">Máscara vlan corporativa: </label>
		<input type="text" id="wificorpMASK" name="wificorpMASK" required><br><br>
		
		<label for="wifiguestVID">VID vlan visitante: </label>
		<input type="number" id="wifiguestVID" name="wifiguestVID" min="1" max="4096" required><br><br>
		
		<label for="wifiguestIP">IP vlan visitante: </label>
		<input type="text" id="wifiguestIP" name="wifiguestIP" required><br><br>
		
		<label for="wifiguestMASK">Máscara vlan visitante: </label>
		<input type="text" id="wifiguestMASK" name="wifiguestMASK" pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" title="Subnet mask must be in dotted decimal format" value="255.255.255.0" placeholder="255.255.255.0" required><br><br>
		
		<label for="devicesVID">VID vlan gerência: </label>
		<input type="number" id="devicesVID" name="devicesVID" min="1" max="4096" required><br><br>
		
		<label for="devicesIP">IP vlan gerência: </label>
		<input type="text" id="devicesIP" name="devicesIP" required><br><br>
		
		<label for="devicesMASK">Máscara vlan gerência: </label>
		<input type="text" id="devicesMASK" name="devicesMASK" pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" title="Subnet mask must be in dotted decimal format" value="255.255.255.0" placeholder="255.255.255.0" required><br><br>
		
		<label for="wificeoVID">VID vlan presidência: </label>
		<input type="number" id="wificeoVID" name="wificeoVID" min="1" max="4096" required><br><br>
		
		<label for="wificeoIP">IP vlan presidência: </label>
		<input type="text" id="wificeoIP" name="wificeoIP" required><br><br>
		
		<label for="wificeoMASK">Máscara vlan presidência: </label>
		<input type="text" id="wificeoMASK" name="wificeoMASK" pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" title="Subnet mask must be in dotted decimal format" value="255.255.255.0" placeholder="255.255.255.0" required><br><br>
		
		<label for="looprbIP">IP loopback RB: </label>
		<input type="text" id="looprbIP" name="looprbIP" required><br><br>
		
		<label for="rbrootPWD">Senha rbroot: </label>
		<input type="password" id="rbrootPWD" name="rbrootPWD" required><br><br>
		
		<label for="ap01IP">IP AcessPoint01: </label>
		<input type="text" id="ap01IP" name="ap01IP" required><br><br>
		
		<label for="ap01MAC">MAC AcessPoint01: </label>
		<input type="text" id="ap01MAC" name="ap01MAC" required><br><br>
		
		<label for="ap02IP">IP AcessPoint02: </label>
		<input type="text" id="ap02IP" name="ap02IP" required><br><br>
		
		<label for="ap02MAC">MAC AcessPoint02: </label>
		<input type="text" id="ap02MAC" name="ap02MAC" required><br><br>
		
		<label for="analyzerIP">IP do FortiAnalyzer: </label>
		<input type="text" id="analyzerIP" name="analyzerIP" required><br><br>

        <button type="submit">Faz a mágica!</button>
    </form>


	<script src="{{ url_for('static', filename='js/script.js') }}"></script>

</body>
</html>
